#include <arduinoFFT.h>

#define START 10
#define SAMPLES 64             //Must be a power of 2
#define SAMPLING_FREQUENCY 2320 //Hz, must be less than 10000 due to ADC

#define NUMARRAYS   15
#define LOWCUTOFF   160
#define HIGHCUTOFF  1470
#define SAMERANGE   50
#define OUTOFRANGES 8

double real[NUMARRAYS][SAMPLES];
double imag[SAMPLES];

double peaks[NUMARRAYS];
double guess[NUMARRAYS];

arduinoFFT FFT = arduinoFFT();

unsigned int sampling_period_us;
unsigned long microseconds;

/**********************************************************************************************/

#define INPUT_DIM    435
#define DIM0    4
#define DIM1    25
#define DIM2    1
double wT0[DIM0][INPUT_DIM] = { { -0.12069673 , -0.07464522 , 0.092651404 , -0.109702535 , -0.10926321 , 0.031696558 , -0.0915185 , -0.07554215 , -0.10696849 , 0.057457987 , -0.016496444 , 0.068010636 , 0.030722322 , -0.11547876 , -0.12998606 , -0.04454634 , -0.06756795 , 0.043699924 , -0.07186835 , -0.022237824 , 0.053456154 , 0.06392438 , -0.08828288 , 0.05530015 , -0.0750096 , -0.07228646 , -0.03376826 , 0.094425656 , 0.02558713 , -0.10635186 , -0.12603065 , 0.06680741 , -0.086284794 , 0.016897127 , -0.072235554 , -0.07255624 , -0.120346725 , -0.103317894 , 0.09795572 , -0.020482734 , 0.09647132 , -0.06565831 , 0.07078062 , -0.09338013 , 0.0296261 , 0.0962074 , -0.094250806 , 0.051489305 , 0.06251918 , -0.11614403 , 0.097763754 , -0.09758831 , 0.084171526 , -0.05776453 , -0.08918022 , -0.06564207 , -0.06579153 , -0.05814161 , 0.053845298 , 0.03503813 , 0.06234752 , 0.039948873 , 0.05583088 , 0.062979616 , 0.025738034 , -0.015688056 , 0.08216551 , 0.024030132 , 0.0556744 , -0.103338264 , -0.10539766 , -0.098273605 , -0.12147435 , -0.12410556 , -0.056433044 , 0.079195134 , -0.023692315 , -0.058974583 , 0.05236143 , -0.06270948 , -0.107243195 , -0.106883176 , 0.057636723 , -0.09905546 , -0.107881 , 0.08088295 , -0.09121614 , -0.10359488 , -0.09049662 , 0.09197919 , 0.06586364 , -0.09959378 , -0.052437592 , -0.0719555 , -0.020107452 , 0.069721304 , 0.028363386 , -0.009183912 , -0.025238056 , -0.04752018 , -0.0042629717 , 0.102028705 , 0.036025036 , 0.013694517 , 0.025896236 , 0.07839918 , -0.06115744 , 0.07648636 , -0.018516015 , 0.038173415 , -0.008175218 , -0.07745779 , -0.06628873 , -0.11012852 , 0.042572662 , 0.07612101 , -0.08211366 , 0.08150572 , -0.057363644 , -0.11623222 , 0.0057757646 , -0.020261362 , -0.07431259 , -0.0956892 , 0.00886357 , -0.036457103 , -0.06919357 , -0.06860406 , -0.06625679 , 0.0947129 , 0.028358076 , -0.08506024 , 0.08635405 , -0.10151456 , -0.057760023 , -0.08373754 , 0.09565728 , -0.06940721 , 0.055227634 , -0.054193337 , 0.095277585 , 0.10038549 , -0.11174779 , -0.0054703536 , -0.056852803 , -0.00028594883 , -0.067460544 , -0.041752808 , 0.048074335 , 0.09574636 , -0.025883824 , -0.08006959 , 0.025443396 , 0.075617634 , -0.11015648 , 0.0008811973 , -0.06918401 , -0.07813683 , -0.046978287 , 0.057557784 , -0.034649502 , -0.120366 , 0.07110982 , 0.070907824 , 0.048829686 , -0.11306099 , 0.08282809 , 0.034104384 , -0.11502136 , 0.0023898508 , 0.063232206 , 0.09862986 , 0.020582546 , 0.072891824 , 0.013861899 , -0.1137133 , 0.06296339 , 0.0023858035 , 0.036993116 , 0.044105265 , 0.08644545 , 0.07518332 , 0.0575952 , -0.10684578 , -0.091968976 , -0.06007782 , -0.03338215 , -0.09478879 , 0.099101536 , 0.047317337 , -0.06587736 , 0.026925564 , 0.08135434 , -0.0035145236 , -0.10210981 , 0.011292893 , -0.050164383 , -0.016456364 , 0.07822303 , 0.02756265 , 0.058136154 , -0.02273362 , 0.056617767 , -0.0591699 , 0.05301155 , -0.027481372 , -0.09548632 , 0.058189817 , -0.09060669 , 0.045505844 , -0.12636194 , 0.0038867136 , 0.01994949 , -0.030559923 , 0.040582366 , 0.059099883 , -0.05988081 , 0.091013014 , 0.07251679 , -0.080052525 , 0.07287663 , -0.12724765 , 0.09331318 , -0.097573325 , -0.012243886 , -0.09103813 , 0.07816738 , -0.08691221 , 0.007235504 , -0.060175642 , -0.054503027 , 0.062254168 , -0.105676845 , 0.009952613 , -0.12635307 , 0.10207841 , 0.007440099 , -0.05938454 , 0.057917543 , 0.07055562 , -0.08940142 , -0.0976636 , -0.120914444 , 0.07951768 , -0.09351177 , 0.076995164 , 0.052412443 , -0.015969358 , -0.044721 , -0.037818793 , -0.1099109 , 0.029217165 , 0.033338457 , -0.09890329 , -0.13003333 , -0.09944839 , -0.07325352 , 0.056602474 , 0.061354935 , 0.06103049 , 0.012808559 , 0.016374504 , -0.05336907 , 0.04335828 , 0.002407463 , -0.058474377 , 0.018975366 , -0.09909771 , 0.06035654 , -0.017511118 , 0.059833083 , 0.034974277 , -0.033952504 , 0.07663244 , 0.06692956 , 0.056255538 , 0.053484935 , -0.015100493 , 0.021693643 , -0.10200207 , -0.011009077 , 0.063222595 , 0.07834069 , -0.10222316 , 0.090358295 , -0.025822336 , 0.003985069 , 0.03680367 , 0.048628394 , 0.03743131 , -0.009977521 , 0.09950883 , -0.06601231 , 0.1034409 , 0.09414356 , -0.040613085 , 0.08312546 , -0.0200235 , 0.04754238 , 0.01685834 , 0.027595652 , -0.09022473 , -0.04071044 , 0.09041516 , -0.08812603 , 0.04619356 , -0.11359488 , 0.07078306 , -0.054346226 , -0.07095369 , -0.04342812 , -0.1090314 , -0.10371661 , -0.046595376 , -0.021906078 , 0.074749514 , -0.01058352 , -0.0039127837 , 0.0023175408 , 0.005462317 , -0.1214886 , -0.020161783 , 0.027097216 , -0.045381095 , 0.0061729457 , 0.046191964 , 0.088135764 , 0.08883651 , 0.012731135 , 0.08867799 , -0.04569141 , 0.07529272 , -0.085939035 , 0.089007035 , 0.050723426 , 0.04906716 , -0.07571388 , -0.061716266 , -0.087326504 , 0.065958895 , -0.038794123 , 0.039444763 , 0.09277515 , -0.03261562 , -0.08143622 , 0.0481525 , 0.09392923 , -0.0044419407 , 0.09550552 , -0.047536552 , -0.08394095 , -0.08974588 , -0.091637745 , -0.00796872 , 0.04372428 , 0.06258359 , 0.020263232 , -0.11036252 , -0.063043214 , 0.039159834 , -0.07471584 , -0.071428895 , -0.009574008 , 0.057925377 , -0.006053593 , -0.08750786 , 0.02883575 , 0.0072805216 , -0.068093315 , 0.019987108 , -0.062394194 , -0.10388144 , 0.04268012 , -0.12069443 , -0.012985333 , -0.0456305 , -0.0849494 , -0.123518586 , 0.0009473357 , 0.008232703 , 0.09087942 , -0.03762696 , -0.022780377 , -0.07175342 , -0.04374788 , -0.0072712875 , -0.076564774 , -0.11042582 , 0.049229357 , -0.0747141 , 0.014019385 , -0.13118075 , 0.0921481 , -0.079791546 , -0.10757209 , -0.11295347 , 0.095799945 , -0.07674825 , -0.108810775 , 0.03487262 , 0.026623914 , -0.0026350105 , -0.081710964 , -0.10362582 , 0.044264212 , -0.0984549 , -0.062430967 , -0.07723591 , 0.018157579 , -0.0065188752 , 0.047279548 , -0.09554495 , 0.037723143 , 0.08817236 , 0.051530488 , -0.006415589 , 0.081643716 , 0.10306852 , -0.08921612 , 0.08302602 , 0.07440311 , -0.028665733 , 0.085616075 , 0.039311484 , 0.08355469 , -0.09431698 , -0.031376794 , -0.0069784727 , -0.0415496 , 0.04769393 , 0.097554564 , 0.007085252 , 0.032635342 , 0.02787143 , -0.013697635 },
{ 0.06464908 , 0.08190143 , -0.11238142 , -0.26180437 , 0.023939682 , 0.091126256 , -0.027382042 , 0.01004394 , -0.031954255 , -0.1467408 , -0.10643593 , 0.004057298 , -0.007494808 , 0.031743683 , -0.09922194 , 0.16207175 , 0.058123354 , -0.011511923 , -0.04330476 , -0.06917156 , -0.064080216 , -0.10850685 , -0.19628708 , 0.19085456 , -0.063580014 , 0.07826469 , -0.007361497 , -0.055235226 , -0.026096074 , 0.13153227 , 0.17919439 , 0.22072749 , 0.1952625 , -0.100630865 , 0.037304796 , 0.0767706 , 0.16430373 , -0.058126263 , -0.19394636 , -0.0792279 , -0.03288534 , 0.095147125 , 0.18664359 , -0.03062999 , 0.030244878 , 0.16667876 , -0.02461635 , 0.018318465 , 0.052338358 , 0.0054057483 , -0.030587077 , -0.07553518 , 0.22401518 , 0.15229769 , 0.05184491 , 0.20190257 , -0.02618728 , 0.020941794 , -0.053291775 , 0.015419079 , 0.09882999 , 0.11686971 , 0.022174584 , 0.16224037 , 0.06373306 , 0.25258234 , 0.024385339 , -0.05501751 , 0.12372062 , -0.018764276 , -0.012946863 , -0.068578556 , 0.026626563 , 0.014949601 , 0.07861674 , 0.0186149 , 0.07424459 , -0.049159013 , -0.10754125 , 5.625968e-06 , -0.02966977 , 0.03513786 , 0.101199225 , 0.043508478 , 0.050060652 , 0.04383129 , -0.016411569 , -0.02197326 , -0.099753104 , -0.06453295 , 0.10680873 , 0.2025862 , 0.04137529 , 0.19229838 , 0.25048015 , 0.08504469 , -0.12981625 , 0.08281938 , -0.0073257326 , 0.025737679 , 0.006038811 , -0.03330993 , -0.06640904 , 0.042559136 , -0.053445447 , -0.077867955 , 0.0420858 , 0.060721245 , -0.099483624 , 0.050796688 , 0.005919844 , -0.025309829 , -0.14506117 , -0.11854266 , 0.054810446 , -0.09159646 , 0.04614633 , -0.08095689 , 0.10722008 , 0.057736374 , 0.034020275 , 0.01496015 , 0.08457946 , 0.19402939 , 0.2210724 , -0.031949498 , 0.097206004 , 0.028319983 , -0.061267238 , -0.11579239 , -0.013403088 , 0.01112393 , 0.025878094 , -0.048645966 , -0.02298941 , -0.026600512 , -0.14155456 , 0.032577675 , 0.008705814 , 0.026914911 , 0.11647217 , 0.0057336665 , 0.117946275 , 0.0326528 , -0.1344479 , -0.16780631 , 0.11643148 , 0.097535856 , 0.28964257 , 0.2002765 , 0.0730069 , 0.05312937 , 0.20419818 , 0.061433204 , 0.07020085 , 0.15545139 , 0.08691804 , -0.022185912 , 0.09376238 , 0.059252325 , 0.049524207 , -0.110748075 , -0.030184649 , -0.0028227563 , 0.038657576 , 0.08724171 , -0.13037224 , -0.17664836 , 0.085026175 , -0.0009878842 , -0.013615697 , 0.15004879 , 0.06626965 , 0.0364962 , -0.17464687 , 0.093744926 , 0.03629639 , 0.15297963 , 0.09633291 , -0.11204878 , 0.12653676 , 0.3086651 , 0.11063778 , -0.009587744 , 0.0017983627 , 0.07871614 , -0.085672595 , -0.021244794 , -0.0034496216 , -0.06633547 , -0.031613927 , -0.067825384 , -0.09000898 , 0.05601918 , -0.06226608 , -0.1468871 , -0.081559494 , 0.015858747 , 0.010068831 , 0.017739741 , -0.041591235 , -0.033378255 , 0.06511373 , -0.026749672 , -0.09074714 , -0.033622526 , -0.15456828 , 0.05789091 , 0.09600383 , -0.074509405 , 0.056099944 , 0.118593104 , -0.06567534 , 0.10762927 , 0.01086605 , 0.05384425 , -0.009174246 , -0.08112431 , -0.06279127 , 0.095551096 , -0.15090047 , -0.09946857 , -0.101983316 , -0.14676957 , -0.025006829 , -0.11164832 , 0.03678074 , 0.14996663 , -0.05391589 , -0.17719622 , -0.05391126 , -0.07073046 , -0.165879 , 0.048011705 , 0.053054404 , -0.054868203 , 0.06328465 , 0.038886864 , -0.0841252 , 0.0039185374 , -0.12948753 , -0.04830141 , -0.12941703 , -0.05876536 , 0.08676614 , -0.05324642 , -0.15335743 , -0.18695085 , -0.08890359 , 0.071174465 , -0.104794905 , 0.033945926 , 0.0542132 , -0.037584428 , -0.015492192 , 0.057862975 , 0.015015386 , -0.0032492073 , -0.19317007 , -0.0032386847 , -0.0020840787 , -0.071052924 , 0.051041678 , -0.027472649 , -0.09308209 , 0.010632357 , -0.04381496 , 0.043211278 , 0.13536167 , 0.021644553 , -0.061538633 , 0.03587925 , 0.08208289 , 0.1687643 , 0.07842821 , -0.015644554 , -0.07800856 , -0.113922924 , -0.08158494 , -0.022221476 , -0.052569967 , 0.027145792 , 0.07853916 , -0.043861363 , 0.02729841 , -0.06182998 , -0.10133059 , -0.087747775 , -0.066495106 , -0.06679193 , -0.15421206 , 0.1264536 , 0.13949914 , 0.030489301 , 0.06047934 , 0.06221209 , -0.038888738 , -0.02837419 , 0.11659161 , -0.17791565 , -0.07536567 , 0.10125217 , 0.077568166 , 0.07102057 , -0.11102308 , -0.094705105 , -0.04527201 , 0.06618435 , -0.042789966 , 0.086293206 , 0.15003939 , -0.0892632 , -0.076085165 , 0.16810508 , 0.008841703 , 0.059197858 , 0.015930807 , -0.048870914 , -0.11700737 , -0.008217455 , 0.002850897 , 0.16712117 , 0.046662424 , -0.034745447 , 0.14658733 , -0.041476183 , -0.012880119 , 0.100064486 , 0.09081793 , 0.0022264062 , 0.063987486 , 0.18213211 , 0.03498818 , -0.03991981 , 0.023203852 , 0.08657628 , -0.015933217 , -0.015309006 , 0.07203984 , -0.012436482 , 0.011519794 , -0.011328552 , 0.13127184 , 0.046001233 , -0.13832957 , 0.017291548 , 0.045520533 , 0.06588958 , -0.040866207 , -0.0511649 , 0.094604544 , -0.027506184 , -0.020685814 , 0.045807827 , -0.06116169 , -0.0076747667 , 0.10297098 , 0.13804813 , -0.0751829 , 0.042128406 , 0.010952892 , -0.09878023 , -0.11955228 , -0.052995622 , 0.061078347 , 0.019531792 , -0.04557404 , -0.00072730746 , 0.14551754 , -0.043365404 , -0.0015095884 , 0.037986156 , -0.02180829 , -0.04577135 , 0.060227595 , 0.020377802 , -0.02204771 , -0.14625017 , -0.052145436 , -0.0106302425 , 0.050765205 , -0.07059897 , 0.012192996 , 0.032104876 , 0.21321216 , 0.09692184 , 0.0112259565 , -0.05682549 , -0.040627394 , 0.009235365 , -0.002912086 , 0.013377341 , -0.05998632 , 0.08460286 , -0.02911953 , -0.11774802 , 0.0987147 , 0.014550292 , -0.1743096 , -0.1382126 , 0.008898643 , -0.038022377 , -0.007443428 , 0.022656567 , -0.034502294 , 0.040882 , -0.033502378 , 0.1579764 , -0.027543081 , 0.17927514 , -0.17743705 , -0.031580087 , -0.07371053 , 0.14256674 , 0.06095504 , 0.046967644 , 0.18856794 , 0.012424465 , -0.15380569 , -0.12940672 , 0.08408358 , 0.023783205 , -0.0044553815 , 0.0748205 , -0.067523435 , -0.001173951 , 0.029941015 , -0.16140722 , -0.16703089 , 0.040705018 , -0.047313847 , 0.011930032 , -0.019321777 , 0.055721432 , -0.011025913 },
{ -0.09340701 , -0.06077626 , 0.033818595 , 0.07523918 , 0.17008261 , -0.09434444 , -0.20478748 , 0.05065669 , -0.04744906 , 0.035287905 , 0.16525224 , 0.08599003 , -0.11330171 , -0.11942604 , -0.023235735 , -0.074883446 , -0.1250914 , 0.010743708 , -0.014673392 , -0.034830533 , 0.08026644 , 0.09698666 , -0.1255298 , -0.030749824 , -0.16381441 , 0.040362272 , 0.12551904 , -0.15054211 , -0.043385085 , 0.13520944 , 0.08055702 , 0.17821068 , 0.09433198 , 0.17399816 , -0.02261585 , 0.04667718 , -0.06162261 , 0.046973146 , 0.0152752595 , 0.021837573 , -0.09013548 , 0.17840198 , -0.0054150457 , -0.049147826 , -0.07456934 , 0.082616836 , -0.08965506 , -0.050432336 , 0.037740346 , -0.05855161 , -0.014626262 , -0.050588403 , -0.031536583 , -0.11879012 , 0.023783606 , 0.14434206 , -0.0485328 , -0.019184561 , -0.11382236 , -0.1073425 , 0.09507691 , 0.013916556 , 0.16483313 , 0.0030683093 , 0.037982564 , 0.116481245 , -0.011088878 , -0.07767866 , 0.2256607 , 0.048847087 , -0.0044147093 , 0.008249072 , 0.046126746 , 0.11096201 , -0.020218618 , -0.025826486 , 0.020589236 , 0.106609225 , -0.04025749 , 0.024899181 , -0.09440093 , -0.22633576 , 0.07727801 , 0.13429852 , 0.083297715 , 0.029534344 , -0.05960243 , -0.117089674 , -0.078715846 , 0.05284249 , 0.033020776 , -0.039448906 , 0.0066424944 , 0.028266069 , -0.05697609 , 0.011410642 , 0.15380178 , 0.13443282 , -0.1888508 , -0.04350796 , 0.044388372 , 0.005016556 , -0.17837965 , -0.15615018 , -0.046151336 , -0.038384877 , -0.14431107 , -0.14200318 , -0.06125163 , -0.074204415 , -0.18055879 , 0.022876719 , 0.055123374 , 0.049379244 , 0.02421011 , 0.0058026114 , -0.012896677 , 0.062292118 , -0.06504831 , -0.068621024 , 0.17459075 , -0.063027926 , -0.12803929 , 0.13584253 , 0.17964903 , -0.014604731 , -0.16753136 , -0.12730369 , 0.0076561673 , 0.014611394 , -0.009622715 , 0.00405705 , -0.1007846 , 0.03215787 , -0.11214726 , -0.039710224 , -0.023264848 , 0.0803137 , -0.05725295 , -0.12516351 , -0.027149737 , -0.016983107 , 0.005460129 , -0.0071151927 , 0.006093196 , 0.09684693 , -0.09870933 , 0.2089387 , 0.22434826 , 0.28638825 , -0.08569586 , -0.042873144 , 0.017204763 , -0.009145255 , 0.022230642 , -0.025999388 , 0.21651207 , -0.016719911 , -0.005977554 , -0.01982111 , 0.043880787 , -0.04445444 , 0.035231568 , -0.04975978 , -0.09874587 , -0.010101556 , 0.0031065377 , -0.03374927 , -0.16697942 , -0.025118485 , 0.13420443 , 0.05335262 , -0.17537455 , -0.1497113 , -0.15025552 , 0.052506734 , 0.21880694 , 0.15224673 , 0.08080708 , 0.054566223 , -0.013766933 , 0.15508813 , 0.13549186 , -0.0066953334 , 0.11267197 , -0.010355442 , -0.09380048 , -0.13907337 , -0.11684273 , 0.024656251 , 0.029132104 , 0.009550107 , 0.08506892 , -0.08428657 , -0.0016635535 , 0.026512591 , -0.04497008 , -0.098526664 , -0.011587743 , 0.06462697 , 0.1030349 , -0.11577497 , -0.04499564 , 0.029781071 , 0.07810223 , 0.25934207 , 0.10755081 , 0.29965508 , -0.082869835 , -0.010597312 , 0.093871325 , -0.04427332 , 0.1478 , -0.09984956 , 0.03690761 , 0.09785701 , 0.0031494552 , 0.02103099 , 0.055946723 , -0.081127524 , 0.0883347 , 0.2229512 , 0.13456076 , 0.067841284 , -0.114727184 , -0.0720978 , -0.16795453 , -0.045037035 , 0.05693922 , 0.090660825 , 0.057517804 , 0.08945673 , 0.08647963 , -0.03862441 , -0.08844135 , 0.0022784222 , 0.18701145 , 0.14726044 , -0.100686446 , 0.09695392 , -0.010276184 , -0.1141492 , -0.10039874 , 0.09577998 , -0.077675745 , -0.06762202 , -0.04943217 , -0.14429331 , -0.14695361 , -0.02905443 , 0.12712857 , 0.11054964 , 0.02872673 , 0.061009012 , 0.019182026 , -0.11526037 , -0.12561423 , 0.07106435 , 0.049125586 , -0.14598228 , 0.068812355 , 0.050475463 , 0.10658947 , 0.1682597 , 0.15826695 , 0.101673804 , 0.09261314 , -0.1771155 , 0.08412406 , 0.10094062 , 0.07369453 , 0.099107236 , 0.10076373 , -0.005850832 , -0.0640709 , -0.23238249 , -0.05045157 , -0.11912035 , -0.24435396 , -0.055717442 , 0.0018306834 , -0.070600905 , -0.0570335 , -0.07987846 , 0.013988584 , -0.21376976 , -0.09171978 , -0.0770333 , -0.015804766 , -0.051979594 , -0.014576668 , 0.04668052 , 0.025917085 , 0.047711745 , 0.06703647 , -0.032706942 , -0.013839607 , 0.037539665 , 0.06918799 , -0.044194076 , -0.048150364 , 0.04954606 , 0.06629794 , 0.11367736 , -0.043328013 , 0.077910505 , 0.12009832 , -0.027012765 , 0.017571148 , 0.011595512 , -0.009976078 , 0.022414263 , -0.07513104 , -0.09149489 , 0.01913493 , 0.041389093 , -0.020389328 , 0.0040951553 , 0.11043015 , 0.06174504 , -0.005698208 , 0.24772198 , 0.06597701 , 0.1406271 , -0.01279054 , -0.11505467 , 0.01321593 , -0.012666892 , 0.08735121 , -0.1231849 , 0.06353308 , 0.13174948 , 0.09056763 , -0.03310304 , 0.09403559 , -0.018557278 , 0.06808301 , -0.031068087 , -0.010541967 , -0.054340817 , -0.011624514 , -0.008623752 , -0.13238332 , -0.12152318 , -0.03839472 , -0.069258474 , -0.10921251 , -0.005713122 , 0.010034927 , 0.086132795 , 0.10789388 , 0.19166125 , -0.032792564 , -0.07016219 , 0.059620984 , -0.016527731 , 0.01526534 , -0.05292281 , 0.041960225 , -0.032006193 , 0.08247011 , -0.06707802 , 0.08421413 , 0.16970131 , -0.06895627 , 0.015398297 , 0.054064646 , -0.116420224 , 0.01889124 , 0.09813277 , -0.03219543 , -0.08199488 , -0.06843332 , 0.13974568 , -0.09985045 , -0.13903677 , -0.007585932 , 0.027058624 , -0.018394059 , 0.12840982 , 0.11488852 , -0.09553102 , -0.0052991216 , 0.05218514 , 0.06862166 , 0.026521232 , -0.041552402 , -0.085513644 , -0.12301303 , 0.0014558014 , -0.19937706 , -0.03435838 , -0.13351123 , 0.031878203 , -0.027159771 , -0.18706882 , -0.105439685 , 0.05704934 , -0.058171995 , -0.09634343 , -0.09693123 , -0.14603698 , 0.08965561 , 0.09305558 , -0.015884612 , -0.044755775 , -0.045555957 , -0.18279453 , 0.16473985 , 0.081007876 , -0.13274693 , 0.15548937 , -0.09276007 , 0.033641733 , 0.048822984 , -0.14973167 , -0.03521948 , 0.0815279 , -0.008228038 , -0.03126865 , 0.12907556 , -0.018189149 , 0.0106402 , 0.008706875 , -0.12553248 , -0.0063748276 , -0.1145972 , 0.06727795 , 0.031085337 , -0.029556101 , -0.073838815 , 0.08169677 , -0.13669708 , -0.10864563 , -0.18029623 },
{ -0.07137276 , 0.07158357 , -0.13432716 , 0.051112648 , -0.034368284 , -0.17949688 , -0.045494836 , 0.004447952 , 0.027076822 , 0.06868538 , -0.0073972554 , -0.054436322 , -0.08798106 , -0.104198985 , -0.042007305 , -0.0639738 , -0.03328558 , -0.07324209 , -0.053048477 , -0.22251937 , -0.06365566 , 0.18138674 , 0.17816734 , 0.04484804 , -0.0062975264 , -0.08163324 , 0.02086652 , 0.035109766 , -0.0010616813 , -0.012059821 , -0.12905547 , -0.13925137 , -0.05035192 , 0.018181823 , -0.043533407 , 0.058804136 , 0.037580676 , -0.103910476 , 0.059874635 , -0.14111808 , -0.06828125 , -0.033842403 , 0.00835647 , -0.059992492 , -0.010341881 , -0.07594839 , 0.038886443 , -0.035125673 , -0.3010465 , -0.0833676 , -0.057038147 , 0.1860125 , -0.035559546 , 0.062943906 , 0.030209476 , -0.022449145 , -0.07152031 , 0.009776595 , 0.16349 , -0.019493794 , 0.092660405 , 0.11513413 , -0.05933594 , -0.04663368 , -0.029465789 , -0.0127415275 , 0.023159336 , -0.066421025 , 0.08346045 , 0.07237197 , -0.024688505 , 0.0153714055 , 0.040914644 , 0.029993242 , -0.03688095 , 0.21747415 , -0.03640506 , -0.14368737 , 0.023613038 , 0.19677949 , 0.20961496 , -0.023304138 , 0.098200716 , 0.035450418 , -0.06797571 , -0.028388673 , 0.008546712 , 0.15140717 , -0.02269731 , 0.020202769 , -0.040367555 , -0.13218327 , -0.019771634 , 0.08693775 , 0.012059048 , -0.07681868 , -0.021416835 , 0.05816074 , 0.024323398 , 0.06997727 , 0.15071411 , 0.061884593 , 0.06309228 , 0.069614016 , 0.06661902 , -0.072822906 , -0.035826627 , -0.05014975 , 0.07571362 , 0.14963841 , -0.06473653 , 0.107782476 , 0.09462139 , -0.010529355 , 0.13414933 , 0.1102495 , 0.15872772 , -0.051913276 , 0.01995682 , -0.05182 , -0.12024193 , -0.054906845 , -0.14381474 , -0.11063714 , -0.10264624 , 0.22783414 , 0.15951335 , -0.019856172 , -0.06196934 , 0.16942014 , -0.118402526 , -0.016554138 , 0.077081844 , 0.30715 , -0.08333476 , -0.16314085 , 0.032927062 , -0.022591235 , 0.07970246 , 0.023774613 , 0.1352438 , 0.004511223 , 0.016502298 , 0.104903825 , 0.047929294 , 0.07534995 , -0.062245253 , -0.053346127 , -0.122670785 , -0.040340096 , 0.05575639 , -0.004873938 , -0.14810722 , -0.087766275 , -0.1344953 , -0.12575261 , -0.035556205 , -0.0134623125 , -0.035149157 , -0.09402441 , 0.09567004 , 0.008951832 , 0.026720446 , -0.010285741 , -0.20594722 , -0.064970024 , 0.19124769 , 0.22741432 , -0.03918313 , 0.12329005 , 0.016033147 , 0.031561688 , 0.042792946 , 0.07766786 , 0.041455757 , 0.055225097 , -0.056526918 , -0.032165423 , 0.11768577 , 0.08890193 , 0.11582311 , -0.15910204 , -0.06463218 , -0.081228904 , -0.091994084 , 0.039499555 , 0.17537795 , 0.20439468 , 0.13691731 , 0.08970237 , 0.084635265 , 0.16368513 , -0.024137491 , -0.08191851 , 0.020799592 , 0.047119085 , 0.06888698 , -0.113988034 , 0.15470931 , -0.0152505785 , 0.032771807 , 0.05601435 , 0.0102455225 , 0.10800072 , 0.019131625 , -0.021427205 , 0.05707961 , -0.012209189 , 0.0350965 , 0.081675224 , 0.0769388 , 0.096945144 , -0.08773479 , 0.029572954 , 0.09586019 , -0.072833635 , 0.05205465 , 0.035846747 , 0.114427835 , 0.061633307 , 0.1394992 , -0.100759685 , -0.11650884 , -0.058382228 , 0.16909638 , 0.03522994 , -0.019137291 , -0.02504543 , 0.11127699 , -0.032872863 , 0.051928055 , 0.012704168 , 0.14075835 , 0.012195532 , 0.0065105697 , 0.10313377 , -0.03527851 , -0.030507132 , 0.01218594 , -0.08748815 , -0.003983768 , 0.19082549 , 0.1304856 , -0.058682907 , 0.07792787 , 0.13611321 , 0.098245345 , 0.029597376 , 0.12295883 , 0.14635922 , 0.034209706 , -0.06442127 , -0.06798991 , 0.06190846 , -0.02659333 , -0.08957838 , 0.08220921 , 0.06728685 , -0.029869543 , 0.1114014 , -0.08852129 , 0.048685826 , 0.014804815 , 0.077627346 , 0.04753169 , -0.13691123 , -0.15500185 , 0.03632599 , -0.008312774 , 0.10709839 , 0.111567594 , -0.004055674 , 0.0422511 , -0.07107069 , -0.015157648 , 0.08278128 , 0.057481393 , 0.06492682 , 0.064059585 , 0.049094893 , -0.1921524 , -0.03490242 , 0.032195095 , 0.07224472 , 0.04418322 , -0.094734006 , -0.028008783 , 0.011841963 , -0.07901541 , 0.047908783 , 0.28508538 , -0.05153844 , -0.013892457 , 0.1918187 , -0.024602592 , 0.048808265 , -0.0010171266 , 0.12251865 , -0.058652274 , 0.09284604 , 0.0121385725 , -0.004751325 , -0.07631666 , -0.0755092 , -0.017227875 , 0.06394074 , -0.052414775 , -0.024335073 , 0.04740133 , -0.08861921 , -0.019906763 , 0.08058839 , 0.068509206 , -0.112509176 , -0.0065912777 , 0.081449814 , -0.028648207 , 0.036794353 , 0.050249856 , -0.05322884 , -0.027605865 , -0.059158314 , -0.16761683 , 0.08093196 , -0.14230654 , -0.059209093 , -0.047739528 , 0.08144232 , 0.13950829 , 0.18467829 , -0.0134194195 , -0.02707998 , -0.09586175 , 0.06015399 , 0.110352896 , 0.043362074 , 0.11727027 , 0.007384894 , -0.015650932 , 0.014315454 , 0.042817216 , 0.18298422 , -0.015928537 , -0.115885034 , 0.14545381 , 0.033514507 , -0.005008304 , 0.082368016 , -0.07317187 , -0.03824172 , -0.13805725 , 0.020714736 , 0.15513206 , -0.047795612 , -0.03919793 , -0.05013172 , -0.10650087 , -0.07394854 , 0.04835034 , 0.08576849 , -0.10024836 , 0.017312834 , -0.03569739 , 0.13426761 , -0.024187056 , 0.047282185 , -0.02844323 , 0.042502265 , -0.09743404 , 0.20635734 , 0.09168151 , -0.070600435 , 0.08640762 , -0.03945718 , 0.14666846 , -0.10790692 , 0.05874999 , -0.018527212 , -0.08232319 , -0.12074865 , 0.048147887 , -0.06364787 , 0.034426812 , 0.0991628 , -0.108523645 , 0.010185595 , 0.11175996 , -0.024090495 , 0.051462967 , -0.005617612 , 0.0253106 , -0.0506103 , 0.08880926 , 0.12627763 , -0.008536179 , -0.033610333 , 0.0054860404 , 0.039995734 , 0.20909041 , 0.23233362 , 0.16688976 , 0.029690934 , 0.018997261 , -0.009041789 , -0.019239008 , 0.18034182 , -0.00063610927 , -0.10821964 , 0.015212051 , -0.112843186 , 0.17625955 , -0.011636437 , 0.048076503 , 0.02216647 , 0.028573144 , 0.120911166 , -0.1571396 , -0.16340671 , 0.1706248 , 0.11477494 , -0.11172211 , 0.062186357 , 0.12541655 , -0.06230224 , -0.027431559 , -0.15530145 , 0.056930553 , 0.20982881 , 0.06991529 , 0.09183895 , 0.022967622 , -0.12148801 , 0.0018015623 , -0.0050394707 , 0.027771268 } };
double wT1[DIM1][DIM0] = { { -0.12305388 , 0.20231675 , -0.4360575 , 0.17020212 },
{ 0.1416717 , 0.34026325 , 0.50978965 , -0.1032066 },
{ -0.06889662 , 0.41346273 , 0.43160707 , -0.22492446 },
{ 0.29066274 , 0.22655262 , 0.099850364 , -0.12032314 },
{ 0.101827145 , 0.4015508 , 0.41511807 , 0.07665999 },
{ 0.2899643 , 0.22761534 , -0.17399986 , -0.11675216 },
{ 0.4597382 , 0.33625448 , -0.2520909 , -0.3473049 },
{ 0.2815747 , -0.038697246 , 0.41034123 , -0.31285033 },
{ -0.12768725 , -0.031853907 , 0.35447738 , -0.26906538 },
{ -0.4166302 , 0.039085202 , 0.23912592 , 0.11529581 },
{ -0.18403938 , 0.42935154 , -0.3502736 , 0.35116088 },
{ 0.3658915 , 0.07723489 , -0.4382643 , -0.75067925 },
{ 0.037951875 , 0.10945427 , 0.5247345 , 0.3057578 },
{ 0.33046785 , -0.28538707 , 0.52547157 , -0.089443855 },
{ 0.44054437 , -0.20136945 , -0.31946576 , 0.42761272 },
{ 0.082312025 , 0.1016029 , -0.051636215 , 0.113313176 },
{ -0.1816217 , -0.2979786 , -0.3822202 , -0.3214298 },
{ -0.3143847 , 0.41574648 , 0.044232156 , -0.1980379 },
{ -0.4431059 , 0.22674158 , -0.49907875 , -0.11094341 },
{ -0.053666353 , 0.445887 , 0.16667524 , 0.19925036 },
{ -0.020625047 , 0.07319636 , -0.16022922 , 0.19087678 },
{ 0.31449842 , -0.36787876 , -0.31228882 , -0.20926204 },
{ 0.06282653 , -0.06990025 , -0.2969752 , 0.15568611 },
{ -0.31960225 , -0.102429956 , -0.18078351 , -0.14740077 },
{ 0.4325616 , -0.11687427 , 0.0153316 , -0.26978162 } };
double wT2[DIM2][DIM1] = { { 0.20445195 , -0.30607513 , -0.21123528 , -0.40860125 , -0.39031312 , 0.02126255 , 0.05301183 , 0.3733981 , 0.43813556 , -0.35113436 , 0.21868937 , 0.6910584 , -0.043041162 , -0.20819226 , 0.46117964 , 0.2559024 , -0.41252083 , -0.40370432 , -0.3362057 , 0.103547536 , -0.41701794 , 0.10725666 , 0.5471206 , -0.20558599 , 1.3501321 } };
double b0[DIM0][1] = { {-0.013783013448119164}, {-0.021604305133223534}, {0.042502325028181076}, {0.022667082026600838} };
double b1[DIM1][1] = { {0.46583372354507446}, {-0.01297841127961874}, {-0.0655401200056076}, {-0.0016670917393639684}, {-0.012113629840314388}, {0.1356601119041443}, {0.44672447443008423}, {0.8385187983512878}, {0.8237294554710388}, {-0.01426673773676157}, {0.43028947710990906}, {0.8789409399032593}, {-0.013457601889967918}, {-0.01161990500986576}, {0.4739149510860443}, {0.46272698044776917}, {0.0}, {-0.07024910300970078}, {-0.06615161895751953}, {0.4386446177959442}, {-0.003435564460232854}, {-0.0002843582187779248}, {0.6760650873184204}, {0.0}, {1.1459310054779053} };
double b2[DIM2][1] = { {0.39681413769721985} };


/**********************************************************************************************/





double z0[DIM0][1];
double z1[DIM1][1];
double z2[DIM2][1];

int input[INPUT_DIM+1];


void getZ0(){
    int counter = 0;

    for(int i = 0; i < DIM0; i++){
        z0[i][0] = 0;
    }

    for(int i = 0; i < DIM0; i++){
        counter = 0;
        for(int k = 0; k < INPUT_DIM; k++){
            z0[i][0] += wT0[i][k]*input[counter];
            counter++;
        }
    }
    for(int i = 0; i < DIM0; i++){
        z0[i][0] += b0[i][0];
        if(z0[i][0] < 0){
            z0[i][0] = 0;
        }
    }


}


void getZ1(){
    int counter = 0;

    for(int i = 0; i < DIM1; i++){
        z1[i][0] = 0;
    }

    for(int i = 0; i < DIM1; i++){
        counter = 0;
        for(int k = 0; k < DIM0; k++){
            z1[i][0] += wT1[i][k]*z0[k][0];
            counter++;
        }
    }
    for(int i = 0; i < DIM1; i++){
        z1[i][0] += b1[i][0];
        if(z1[i][0] < 0){
            z1[i][0] = 0;
        }
    }
}

void getZ2(){
    int counter = 0;

    for(int i = 0; i < DIM2; i++){
        z2[i][0] = 0;
    }

    for(int i = 0; i < DIM2; i++){
        counter = 0;
        for(int k = 0; k < DIM1; k++){
            z2[i][0] += wT2[i][k]*z1[k][0];
            counter++;
        }
    }
    for(int i = 0; i < DIM2; i++){
        z2[i][0] += b2[i][0];
    }
}

char hypo(){
    getZ0();
    getZ1();
    getZ2();
    if(z2[0][0] > 0){
        return 's';
    }
    return 'h';
}

double calcVar(int x){
  double sum = 0;
  for(int i = 0; i < SAMPLES; i++){
    sum += real[x][i];
  }
  double mean = sum / SAMPLES;
  sum = 0;
  for(int i = 0; i < SAMPLES; i++){
    sum += (real[x][i] - mean)*(real[x][i] - mean);
  }
  return (sum / SAMPLES);
}

void iSetup(){
    sampling_period_us = round(1000000*(1.0/SAMPLING_FREQUENCY));
}

char iLoop(){

    /*SAMPLING*/
    unsigned int x;
    int readInt;
    int counter = 0;
    for(int i=0; i<NUMARRAYS; i++){
      for(int j=0; j<SAMPLES; j++){
          microseconds = micros();
          readInt = analogRead(1);
          real[i][j] = readInt;
          x = (microseconds + sampling_period_us);
          while(micros() < x){
          }
      }
      if(i == 0){
        if(calcVar(0) < 20){
          i--;
        }
      }
    }

    int z;
    int inCounter = 0;
    for(int i=0; i<NUMARRAYS; i++){
      FFT.Windowing(real[i], SAMPLES, FFT_WIN_TYP_HAMMING, FFT_FORWARD);
      FFT.Compute(real[i], imag, SAMPLES, FFT_FORWARD);
      FFT.ComplexToMagnitude(real[i], imag, SAMPLES);
      double peak = FFT.MajorPeak(real[i], SAMPLES, SAMPLING_FREQUENCY);
      for(int m = 4; m < SAMPLES/2 + 1; m++){
        z = real[i][m]*0.6;
        if(z < 255){
          input[inCounter] = z;
        }else{
          input[inCounter] = 255;
        }
        inCounter++;
      }
      for(int j = 0; j < SAMPLES; j++){
        imag[j] = 0;
      }
    }

    return hypo();

}
